// Title: Win Susp Computer Name Containing Samtheadmin
// Author: elhoim
// Date: 2022-09-09
// Level: critical
// Description: Detects suspicious computer name samtheadmin-{1..100}$ generated by hacktoolThe SecurityEvent table in Microsoft Sentinel contains security-related events from Windows machines. To have this table present, ensure that the Microsoft Monitoring Agent is installed on the Windows machines and configured to send security events to Sentinel.
// Tags: cve.2021-42278, cve.2021-42287, attack.persistence, attack.privilege-escalation, attack.t1078
// ================================================================== 

SecurityEvent
| where (SamAccountName endswith "$" and SamAccountName startswith "SAMTHEADMIN-") or (TargetUserName endswith "$" and TargetUserName startswith "SAMTHEADMIN-")