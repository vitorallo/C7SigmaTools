// Title: Malware User Agent
// Author: Florian Roth (Nextron Systems), X__Junior (Nextron Systems), Nasreddine Bencherchali (Nextron Systems)
// Date: 2017-07-08
// Level: high
// Description: Detects suspicious user agent strings used by malware in proxy logsThis table contains proxy logs, which can be queried for information related to proxy activity. Ensure that the necessary connectors are set up to collect proxy logs in Sentinel.
// Tags: attack.command-and-control, attack.t1071.001
// ================================================================== 

ProxyLog
| where 'c-useragent' in~ ("Mozilla/5.0 (Windows NT 6.1; WOW64; rv:53.0) Gecko/20100101 Chrome /53.0", "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1)", "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0)", "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR  1.1.4322)", "HttpBrowser/1.0", "nsis_inetc (mozilla)", "Wget/1.9+cvs-stable (Red Hat modified)", "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; .NET CLR 1.1.4322)", "Mozilla/5.0 WinInet", "RookIE/1.0", "M", "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/4.0)", "Mozilla/4.0 (compatible;MSIE 7.0;Windows NT 6.0)", "backdoorbot", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30731)", "Opera/8.81 (Windows NT 6.0; U; en)", "Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.9.2.3) Gecko/20100401 Firefox/3.6.1 (.NET CLR 3.5.30729)", "Opera", "Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)", "Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)", "MSIE", "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/5.0)", "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT)", "Mozilla/4.0(compatible; MSIE 6.0; Windows NT 5.1)", "Mozilla/5.0 (Windows NT 10.0; Win64; x64)", "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 10.0; Win64; x64)", "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Win64; x64)", "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.2; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; InfoPath.3)", "Mozilla/5.0 (Windows NT 6.1)", "AppleWebkit/587.38 (KHTML, like Gecko)", "Chrome/91.0.4472.77", "Safari/537.36", "Edge/91.0.864.37", "Firefox/89.0", "Gecko/20100101", "sample", "nocase", "Moxilla", "AutoIt", "IczelionDownLoad", "Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 10.0; .NET4.0C; .NET4.0E; Tablet PC 2.0)", "record", "mozzzzzzzzzzz", "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0", "Havana/0.1", "antSword/v2.1", "rqwrwqrqwrqw", "qwrqrwrqwrqwr", "rc2.0/client", "TakeMyPainBack", "xxx", "20112211", "23591", "901785252112", "1235125521512", "125122112551", "B1D3N_RIM_MY_ASS", "AYAYAYAY1337", "iMightJustPayMySelfForAFeature", "ForAFeature", "Microsoft Internet Explorer", "CLCTR", "uploader", "agent", "License", "vb wininet", "Client", "Lilith-Bot/3.0", "svc/1.0", "WSHRAT", "ZeroStresser Botnet/1.5", "OK", "Project1sqlite", "Project1", "DuckTales", "Zadanie", "GunnaWunnaBlueTips", "Xlmst", "GeekingToTheMoon", "SunShineMoonLight", "BunnyRequester", "BunnyTasks", "BunnyStealer", "BunnyLoader_Dropper", "BunnyLoader", "BunnyShell", "SPARK-COMMIT", "4B4DB4B3", "SouthSide", "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Tob 1.1)") or ''c-useragent'' contains "<|>" or ''c-useragent'' contains "zeroup" or ''c-useragent'' startswith "Mozilla/5.0 (Windows NT 5.1 ; v." or ''c-useragent'' contains " adlib/" or ''c-useragent'' endswith " tiny" or ''c-useragent'' contains " BGroom " or ''c-useragent'' endswith " changhuatong" or ''c-useragent'' endswith " CholTBAgent" or ''c-useragent'' endswith "(Charon; Inferno)" or ''c-useragent'' contains " pxyscand" or ''c-useragent'' endswith " asd" or ''c-useragent'' endswith " mdms" or ''c-useragent'' startswith "Win32 " or ''c-useragent'' contains "Microsoft Internet Explorer" or ''c-useragent'' startswith "agent " or ''c-useragent'' startswith "Ares_ldr_v_"