// Title: Potential WizardUpdate Malware Infection
// Author: Tim Rauch (rule), Elastic (idea)
// Date: 2022-10-17
// Level: high
// Description: Detects the execution traces of the WizardUpdate malware. WizardUpdate is a macOS trojan that attempts to infiltrate macOS machines to steal data and it is associated with other types of malicious payloads, increasing the chances of multiple infections on a device.
// Tags: attack.command-and-control
// ================================================================== 

DeviceProcessEvents
| where ((ProcessCommandLine contains "=$(curl " and ProcessCommandLine contains "eval") and FolderPath endswith "/sh") or (ProcessCommandLine contains "_intermediate_agent_" and FolderPath endswith "/curl")