// Title: Potential OGNL Injection Exploitation In JVM Based Application
// Author: Moti Harmats
// Date: 2023-02-11
// Level: high
// Description: Detects potential OGNL Injection exploitation, which may lead to RCE.
// OGNL is an expression language that is supported in many JVM based systems.
// OGNL Injection is the reason for some high profile RCE's such as Apache Struts (CVE-2017-5638) and Confluence (CVE-2022-26134)
// This table contains information about application requests, including error logs with LOG_LEVEL=ERROR and above. Make sure to have the necessary connectors or data sources set up in Sentinel to collect application error logs.
// Tags: attack.initial-access, attack.t1190, cve.2017-5638, cve.2022-26134
// ================================================================== 

AppRequests
| where "org.apache.commons.ognl.OgnlException" or "ExpressionSyntaxException"