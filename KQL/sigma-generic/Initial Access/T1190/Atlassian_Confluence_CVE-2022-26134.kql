// Title: Atlassian Confluence CVE-2022-26134
// Author: Nasreddine Bencherchali (Nextron Systems)
// Date: 2022-06-03
// Level: high
// Description: Detects spawning of suspicious child processes by Atlassian Confluence server which may indicate successful exploitation of CVE-2022-26134
// Tags: attack.initial-access, attack.execution, attack.t1190, attack.t1059, cve.2022-26134
// ================================================================== 

DeviceProcessEvents
| where (ProcessCommandLine contains "/bin/sh" or ProcessCommandLine contains "bash" or ProcessCommandLine contains "dash" or ProcessCommandLine contains "ksh" or ProcessCommandLine contains "zsh" or ProcessCommandLine contains "csh" or ProcessCommandLine contains "fish" or ProcessCommandLine contains "curl" or ProcessCommandLine contains "wget" or ProcessCommandLine contains "python") and InitiatingProcessFolderPath endswith "/java" and InitiatingProcessFolderPath startswith "/opt/atlassian/confluence/"