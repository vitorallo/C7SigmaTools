// Title: Download From Suspicious TLD - Blacklist
// Author: Florian Roth (Nextron Systems)
// Date: 2017-11-07
// Level: low
// Description: Detects download of certain file types from hosts in suspicious TLDsThis table contains proxy logs, which can be queried to retrieve information related to proxy activity. Ensure that the necessary connectors or data sources are configured in Sentinel to collect proxy logs and populate this table.
// Tags: attack.initial-access, attack.t1566, attack.execution, attack.t1203, attack.t1204.002
// ================================================================== 

ProxyLog
| where ('c-uri-extension' in~ ("exe", "vbs", "bat", "rar", "ps1", "doc", "docm", "xls", "xlsm", "pptm", "rtf", "hta", "dll", "ws", "wsf", "sct", "zip")) and (''cs-host'' endswith ".country" or ''cs-host'' endswith ".stream" or ''cs-host'' endswith ".gdn" or ''cs-host'' endswith ".mom" or ''cs-host'' endswith ".xin" or ''cs-host'' endswith ".kim" or ''cs-host'' endswith ".men" or ''cs-host'' endswith ".loan" or ''cs-host'' endswith ".download" or ''cs-host'' endswith ".racing" or ''cs-host'' endswith ".online" or ''cs-host'' endswith ".science" or ''cs-host'' endswith ".ren" or ''cs-host'' endswith ".gb" or ''cs-host'' endswith ".win" or ''cs-host'' endswith ".top" or ''cs-host'' endswith ".review" or ''cs-host'' endswith ".vip" or ''cs-host'' endswith ".party" or ''cs-host'' endswith ".tech" or ''cs-host'' endswith ".xyz" or ''cs-host'' endswith ".date" or ''cs-host'' endswith ".faith" or ''cs-host'' endswith ".zip" or ''cs-host'' endswith ".cricket" or ''cs-host'' endswith ".space" or ''cs-host'' endswith ".info" or ''cs-host'' endswith ".vn" or ''cs-host'' endswith ".cm" or ''cs-host'' endswith ".am" or ''cs-host'' endswith ".cc" or ''cs-host'' endswith ".asia" or ''cs-host'' endswith ".ws" or ''cs-host'' endswith ".tk" or ''cs-host'' endswith ".biz" or ''cs-host'' endswith ".su" or ''cs-host'' endswith ".st" or ''cs-host'' endswith ".ro" or ''cs-host'' endswith ".ge" or ''cs-host'' endswith ".ms" or ''cs-host'' endswith ".pk" or ''cs-host'' endswith ".nu" or ''cs-host'' endswith ".me" or ''cs-host'' endswith ".ph" or ''cs-host'' endswith ".to" or ''cs-host'' endswith ".tt" or ''cs-host'' endswith ".name" or ''cs-host'' endswith ".tv" or ''cs-host'' endswith ".kz" or ''cs-host'' endswith ".tc" or ''cs-host'' endswith ".mobi" or ''cs-host'' endswith ".study" or ''cs-host'' endswith ".click" or ''cs-host'' endswith ".link" or ''cs-host'' endswith ".trade" or ''cs-host'' endswith ".accountant" or ''cs-host'' endswith ".cf" or ''cs-host'' endswith ".gq" or ''cs-host'' endswith ".ml" or ''cs-host'' endswith ".ga" or ''cs-host'' endswith ".pw")