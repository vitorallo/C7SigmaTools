// Title: HackTool - Generic Process Access
// Author: Nasreddine Bencherchali (Nextron Systems), Swachchhanda Shrawan Poudel
// Date: 2023-11-27
// Level: high
// Description: Detects process access requests from hacktool processes based on their default image nameProcessCreationEvents table in Microsoft Sentinel contains process access information for Windows systems. Make sure to have the necessary connectors or data sources configured in Sentinel to collect Windows process access logs.
// Tags: attack.credential-access, attack.t1003.001, attack.s0002
// ================================================================== 

ProcessCreationEvents
| where (InitiatingProcessFolderPath endswith "\\Akagi.exe" or InitiatingProcessFolderPath endswith "\\Akagi64.exe" or InitiatingProcessFolderPath endswith "\\atexec_windows.exe" or InitiatingProcessFolderPath endswith "\\Certify.exe" or InitiatingProcessFolderPath endswith "\\Certipy.exe" or InitiatingProcessFolderPath endswith "\\CoercedPotato.exe" or InitiatingProcessFolderPath endswith "\\crackmapexec.exe" or InitiatingProcessFolderPath endswith "\\CreateMiniDump.exe" or InitiatingProcessFolderPath endswith "\\dcomexec_windows.exe" or InitiatingProcessFolderPath endswith "\\dpapi_windows.exe" or InitiatingProcessFolderPath endswith "\\findDelegation_windows.exe" or InitiatingProcessFolderPath endswith "\\GetADUsers_windows.exe" or InitiatingProcessFolderPath endswith "\\GetNPUsers_windows.exe" or InitiatingProcessFolderPath endswith "\\getPac_windows.exe" or InitiatingProcessFolderPath endswith "\\getST_windows.exe" or InitiatingProcessFolderPath endswith "\\getTGT_windows.exe" or InitiatingProcessFolderPath endswith "\\GetUserSPNs_windows.exe" or InitiatingProcessFolderPath endswith "\\gmer.exe" or InitiatingProcessFolderPath endswith "\\hashcat.exe" or InitiatingProcessFolderPath endswith "\\htran.exe" or InitiatingProcessFolderPath endswith "\\ifmap_windows.exe" or InitiatingProcessFolderPath endswith "\\impersonate.exe" or InitiatingProcessFolderPath endswith "\\Inveigh.exe" or InitiatingProcessFolderPath endswith "\\LocalPotato.exe" or InitiatingProcessFolderPath endswith "\\mimikatz_windows.exe" or InitiatingProcessFolderPath endswith "\\mimikatz.exe" or InitiatingProcessFolderPath endswith "\\netview_windows.exe" or InitiatingProcessFolderPath endswith "\\nmapAnswerMachine_windows.exe" or InitiatingProcessFolderPath endswith "\\opdump_windows.exe" or InitiatingProcessFolderPath endswith "\\PasswordDump.exe" or InitiatingProcessFolderPath endswith "\\Potato.exe" or InitiatingProcessFolderPath endswith "\\PowerTool.exe" or InitiatingProcessFolderPath endswith "\\PowerTool64.exe" or InitiatingProcessFolderPath endswith "\\psexec_windows.exe" or InitiatingProcessFolderPath endswith "\\PurpleSharp.exe" or InitiatingProcessFolderPath endswith "\\pypykatz.exe" or InitiatingProcessFolderPath endswith "\\QuarksPwDump.exe" or InitiatingProcessFolderPath endswith "\\rdp_check_windows.exe" or InitiatingProcessFolderPath endswith "\\Rubeus.exe" or InitiatingProcessFolderPath endswith "\\SafetyKatz.exe" or InitiatingProcessFolderPath endswith "\\sambaPipe_windows.exe" or InitiatingProcessFolderPath endswith "\\SelectMyParent.exe" or InitiatingProcessFolderPath endswith "\\SharpChisel.exe" or InitiatingProcessFolderPath endswith "\\SharPersist.exe" or InitiatingProcessFolderPath endswith "\\SharpEvtMute.exe" or InitiatingProcessFolderPath endswith "\\SharpImpersonation.exe" or InitiatingProcessFolderPath endswith "\\SharpLDAPmonitor.exe" or InitiatingProcessFolderPath endswith "\\SharpLdapWhoami.exe" or InitiatingProcessFolderPath endswith "\\SharpUp.exe" or InitiatingProcessFolderPath endswith "\\SharpView.exe" or InitiatingProcessFolderPath endswith "\\smbclient_windows.exe" or InitiatingProcessFolderPath endswith "\\smbserver_windows.exe" or InitiatingProcessFolderPath endswith "\\sniff_windows.exe" or InitiatingProcessFolderPath endswith "\\sniffer_windows.exe" or InitiatingProcessFolderPath endswith "\\split_windows.exe" or InitiatingProcessFolderPath endswith "\\SpoolSample.exe" or InitiatingProcessFolderPath endswith "\\Stracciatella.exe" or InitiatingProcessFolderPath endswith "\\SysmonEOP.exe" or InitiatingProcessFolderPath endswith "\\temp\\rot.exe" or InitiatingProcessFolderPath endswith "\\ticketer_windows.exe" or InitiatingProcessFolderPath endswith "\\TruffleSnout.exe" or InitiatingProcessFolderPath endswith "\\winPEASany_ofs.exe" or InitiatingProcessFolderPath endswith "\\winPEASany.exe" or InitiatingProcessFolderPath endswith "\\winPEASx64_ofs.exe" or InitiatingProcessFolderPath endswith "\\winPEASx64.exe" or InitiatingProcessFolderPath endswith "\\winPEASx86_ofs.exe" or InitiatingProcessFolderPath endswith "\\winPEASx86.exe" or InitiatingProcessFolderPath endswith "\\xordump.exe") or (InitiatingProcessFolderPath contains "\\goldenPac" or InitiatingProcessFolderPath contains "\\just_dce_" or InitiatingProcessFolderPath contains "\\karmaSMB" or InitiatingProcessFolderPath contains "\\kintercept" or InitiatingProcessFolderPath contains "\\LocalPotato" or InitiatingProcessFolderPath contains "\\ntlmrelayx" or InitiatingProcessFolderPath contains "\\rpcdump" or InitiatingProcessFolderPath contains "\\samrdump" or InitiatingProcessFolderPath contains "\\secretsdump" or InitiatingProcessFolderPath contains "\\smbexec" or InitiatingProcessFolderPath contains "\\smbrelayx" or InitiatingProcessFolderPath contains "\\wmiexec" or InitiatingProcessFolderPath contains "\\wmipersist" or InitiatingProcessFolderPath contains "HotPotato" or InitiatingProcessFolderPath contains "Juicy Potato" or InitiatingProcessFolderPath contains "JuicyPotato" or InitiatingProcessFolderPath contains "PetitPotam" or InitiatingProcessFolderPath contains "RottenPotato")