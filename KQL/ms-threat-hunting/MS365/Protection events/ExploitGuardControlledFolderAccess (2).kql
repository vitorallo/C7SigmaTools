// Description: Total Controlled Folder Access events.
// Required Connectors: MicrosoftThreatProtection (Types: DeviceEvents)

// Exploit Guard Controlled Folder Access details
DeviceEvents 
| where ActionType contains "ControlledFolderAccess"
| extend JsonOut = parse_json(AdditionalFields)
| sort by Timestamp desc 
| project Timestamp, DeviceName, InitiatingProcessAccountName, ActionType,  
         FileName, FolderPath, RemoteUrl, ProcessCommandLine, InitiatingProcessCommandLine,
         JsonOut.IsAudit,JsonOut.Uri,JsonOut.RuleId,JsonOut.ActivityId