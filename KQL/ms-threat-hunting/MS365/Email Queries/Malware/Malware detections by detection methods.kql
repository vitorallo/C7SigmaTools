// Description: This query helps reviewing malware detections by detection methods
// Required Connectors: MicrosoftThreatProtection (Types: EmailEvents)

EmailEvents
| where Timestamp > ago(30d)
| where isnotempty(DetectionMethods)
| extend MDO_detection = parse_json(DetectionMethods)
| where MDO_detection.Malware in 
        (
          @'["File detonation reputation"]',
          @'["File detonation"]',
          @'["File reputation"]',
          @'["Antimalware engine"]',
          @'["URL malicious reputation"]',
          @'["URL detonation reputation"]',
          @'["URL detonation"]'
        )
| extend SenderFromAddress_IPv4 = strcat(SenderFromAddress, ", ", SenderIPv4)
| project Timestamp, NetworkMessageId, Subject, SenderFromAddress_IPv4, RecipientEmailAddress, DeliveryLocation, MDO_detection.Malware